
<h1>Testing</h1>
<p><span class="para-title">TDD: </span>
  Test anything that might break, New Code is quilty until proven innocent,
      Write at least as much test code as production code
      Run all testc before check-in to repository
</p>
<p><span class="para-title">Unit Tests: </span>
  Getestet werden einzelne "Units": Klassen, Module (meist ein File)
      Automation relativ einfach, <b>Herausforderung:</b> Isolation der Units, asynchrone Operationen,
      Testdatengenerierung (z.B. Fuzzing)
</p>
<p><span class="para-title">System Tests: </span>
      Getestet wird das Zusammenspiel aller Systemkomponenten in der Zielumgebung
      Automation meist nur in Teilen möglich.<b>Herausforderungen</b>: Realistische aber vorhersagbare Umgebung<b>Weitere System Tests:</b>Load Tests, Performance Tests, Endurance Tests, Chaos Tests, Security Tests,
      Usability Tests
</p>
<p><span class="para-title">Integration Tests: </span>
  Getestet wird das Zusammenspiel 2 oder mehr "Units"
      (E2E: Integration über alle Layer), Automation meist möglich<b>Herausforderungen:</b> Isolation der Units, asynchrone Operationen, Simulation Browser &amp;
      Benutzerinteraktion, Test mit Datenbank, Testdatengenerierung (z.B. Fuzzing)
</p>
<p><span class="para-title">(Visuelle) Regression Tests: </span>
      Getestet wird ob Veränderungen im Code zu (unerwarteten) Änderungen im Verhalten (oder UI)
      führen. Automation möglich mit speziellen Tools
</p>
<p><span class="para-title">Test-Runner: </span>
  Ein Rahmen der Tests entgegennimmt, ausführt und die Resultate
      anzeigt.<b>Beispiele:</b> Jest, Mocha, Jasmin
</p>
<p><span class="para-title">Assertion-Libraries: </span>    Code zur Ausführung einzelner Tests<b>Beispiele: </b> Assert, Chai, Expect.js
</p>
<p><span class="para-title">Mocking-Library: </span>    Separierung von Units / Erstellung von Mocks etc.<b>Beispiele: </b>Expect.js, Proxyquire, Sinon.js
</p>
<p><span class="para-title">Phasen eines Tests: </span>
  <ul></ul>
  <li><b>Setup:</b> beforeEach Initialization, selbe Ausgangslage für alle Tests</li>
  <li><b>Exercise:</b> Aufruf einer Funktion (mit return value)</li>
  <li><b>Verify:</b> Überprüfen von Annahmen</li>
  <li><b>Teardown:</b> Zurücksetzen z.B. von mocks</li>
</p>
<p><span class="para-title">Beispiele: </span>
  <pre class="code"><code class="language-javascript">const chai = require('chai');
const sinon = require("sinon");
const proxyquire = require("proxyquire");
const expect = chai.expect;
function stub(v) {return v*2;}
const currencyConverter = proxyquire("../cc", { convert: stub });
describe("A new bank account", function() {
beforeEach(function() {
   this.account = new BankAccount();
   clock = sinon.useFakeTimers(constantNow); // stub/fake Date
   this.converter = new currencyConverter("mysecret");
   this.accountAWithdrawSpy=sinon.spy(this.accountA,"withdraw");
});
afterEach(function() {
   clock.restore();
})
it("is initialized by a balance of 0", function() {
   expect(this.account.balance).to.equal(0);
});
it("should convert correct", function() {
   this.account.add(20);
   expect(converter(this.account.balance)).to.equal(40);
});
it("correctly calls withdrawal", function() {
   this.transaction.execute();
   sinon.assert.calledWith(this.accountAWithdrawSpy,
   transactionAmount);
   //expect(this.accountAWithdrawSpy
   //.calledWith(transactionAmount)).to.be.true;
   });
it("should not allow a withdraw", function() {
   expect(this.account.withdraw(50)).to.equal(false);
   expect(this.account.balance).to.throw(new NoMoneyError("No money"));
});
});</code></pre>
</p>
<p><span class="para-title">Chai Chains: </span>
  <ul></ul>
  <li>.to, .be, .been, .is, .that, .which, .and, .not</li>
  <li>.true, .false, .undefined, .NaN, .exist,</li>
  <li>
    .equal(
    &lt;value&gt;), .deep.equal(
    &lt;value&gt;)
  </li>
  <li>
    .includes([…
    &lt;value&gt;]), .any.keys, .all.keys
  </li>
  <li>
    .a(
    &lt;baseType&gt;), instanceOf(
    &lt;class&gt;)
  </li>
  <li>throws()</li>
</p>
<p><span class="para-title">Test Doubles: </span>Abhängigkeiten möglichst lose, für tests Doubles verwenden
  <ul></ul>
  <li>Stub &amp; Fake: liefern vorbestimmten Wert</li>
  <li>Spy &amp; Mock: Helfen einen überprüfbaren Content zu generieren</li>
</p>
<p><span class="para-title">Test-Smells: </span>
  <ul></ul>
  <li>Hard-to-Test Code: Schlecht geschriebener Code</li>
  <li>Production Bugs: Zuviele Bugs während testing oder in prod</li>
  <li>Fragile Test: Tests verhalten sich verschieden auf unterschieldichen Systemen</li>
  <li>Errativ Test: Test funktionieren manchmal und manchmal nicht</li>
  <li>Es gibt keine Tests</li>
</p>